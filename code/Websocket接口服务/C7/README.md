# 使用中介模式管理用户示例

这个例子需要有一套用户系统,这边做了相当的简化.

1. 只有用户名
2. 验证的token只是token的base64转码
3. 用户完全没有服务端的保存,只是做个用户名的去重而已

在服务端使用一个Map的常量`CLIENTS`来管理所有的用户名,ws对,在验证用户和用户退出时会对这个map做增删.

这个例子的流程是:

1. 建立连接后客户端向服务端发起验证请求
2. 服务端处理验证请求后创建一个token发回给客户端
3. 客户端收到token后发起查询用户列表的操作,服务端将当前的用户名列表发送回去给客户端
4. 客户端收到用户列表后发起talk事件,代上消息给服务端,客户端发送talk事件的消息会根据用户列表的长度来判断,如果长度>3,那么使用一个随机数判断要通过字段`with_cilents`发给第一个人还是第二个人,否则就不带字段`with_cilents`
5. 服务端收到talk事件后如果没有字段`with_cilents`则发起广播,否则查找`with_cilents`列表中的用户发送

## 用法

+ `npm run build`将源码编译到server文件夹
+ `npm start`启动服务
+ `npm run test`测试使用聊天室,可以多起几个看效果




